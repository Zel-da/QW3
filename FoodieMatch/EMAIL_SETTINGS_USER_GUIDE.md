# 이메일 설정 사용자 가이드

## 목차
- [개요](#개요)
- [접근 방법](#접근-방법)
- [1. 템플릿 관리](#1-템플릿-관리)
- [2. 스케줄 관리](#2-스케줄-관리)
- [3. 조건부 발송](#3-조건부-발송)
- [4. 발송 이력](#4-발송-이력)
- [5. 테스트 발송](#5-테스트-발송)
- [FAQ](#faq)
- [문제 해결](#문제-해결)

---

## 개요

이메일 설정은 안전보건교육 플랫폼에서 자동으로 발송되는 이메일을 관리하는 기능입니다.

### 주요 기능
- **템플릿 관리**: 이메일 내용과 디자인 관리
- **스케줄 관리**: 정기적인 이메일 자동 발송 (예: 매일 오전 7시)
- **조건부 발송**: 특정 조건 충족 시 자동 발송 (예: TBM 3일 미작성)
- **발송 이력**: 전송된 이메일 기록 및 통계 확인
- **테스트 발송**: 실제 발송 전 테스트

### 사용 가능한 이메일 타입

| 이메일 타입 | 설명 | 발송 대상 |
|------------|------|----------|
| **교육 미이수자 알림** | 교육을 완료하지 않은 사용자에게 알림 | 미이수자 |
| **TBM 작성 독려** | TBM 일지를 작성하지 않은 팀장에게 알림 | 팀장 |
| **월별 안전점검 알림** | 안전점검 기한을 알림 | 팀장, 관리자 |
| **교육 완료 알림** | 교육 완료를 축하하는 이메일 | 완료한 사용자 |
| **이수증 발급 알림** | 이수증 발급 완료 알림 | 이수증 발급자 |
| **공지사항 알림** | 새 공지사항 등록 시 알림 | 전체 사용자 |
| **안전점검 결과 공유** | 안전점검 결과를 공유 | 팀장, 관리자 |

---

## 접근 방법

### 권한 요구사항
- **관리자(ADMIN) 권한 필요**
- 일반 사용자는 접근 불가

### 접근 경로
1. 관리자 계정으로 로그인
2. 상단 메뉴에서 **"이메일 설정"** 클릭
3. 5개의 탭 중 하나 선택:
   - 템플릿 관리
   - 스케줄 관리
   - 조건부 발송
   - 발송 이력
   - 테스트 발송

---

## 1. 템플릿 관리

이메일의 내용과 디자인을 관리합니다.

### 1.1 템플릿 목록 보기

**화면 구성:**
- 템플릿 이름
- 타입 (예: 교육 미이수자 알림)
- 활성화 상태 (초록색 "활성" 또는 "비활성")
- 간단한 설명

### 1.2 새 템플릿 만들기

**단계:**
1. **"새 템플릿"** 버튼 클릭
2. 템플릿 정보 입력:

| 필드 | 설명 | 예시 |
|------|------|------|
| **템플릿 이름** | 템플릿을 구분하는 이름 | `교육 미이수자 알림` |
| **타입** | 템플릿 종류 선택 | `EDUCATION_REMINDER` |
| **제목** | 이메일 제목 (변수 사용 가능) | `[안전교육] {{courseName}} 이수 안내` |
| **HTML 내용** | 이메일 본문 (HTML 지원) | 아래 참조 |
| **사용 가능한 변수** | 템플릿에서 사용할 변수 목록 (JSON 배열) | `["userName", "courseName"]` |
| **설명** | 템플릿 설명 (선택사항) | `교육 미이수자에게 발송` |
| **활성화** | 사용 여부 | 체크 ✓ |

3. **"저장"** 버튼 클릭

### 1.3 변수 사용법

**변수 형식:** `{{변수이름}}`

**사용 가능한 변수 목록:**

#### 교육 관련 변수
- `{{userName}}` - 사용자 이름
- `{{courseName}}` - 교육 과정 이름
- `{{dueDate}}` - 마감일
- `{{completionDate}}` - 완료일
- `{{certificateUrl}}` - 이수증 URL

#### TBM 관련 변수
- `{{managerName}}` - 관리자 이름
- `{{teamName}}` - 팀 이름
- `{{date}}` - 날짜

#### 공지사항 관련 변수
- `{{noticeTitle}}` - 공지사항 제목
- `{{noticeUrl}}` - 공지사항 링크

#### 안전점검 관련 변수
- `{{month}}` - 월
- `{{resultsUrl}}` - 결과 페이지 링크

#### 공통 변수
- `{{baseUrl}}` - 시스템 기본 URL

**예시:**
```html
<p>안녕하세요, {{userName}}님!</p>
<p>{{courseName}} 교육을 {{dueDate}}까지 완료해주세요.</p>
<a href="{{baseUrl}}/courses">교육 시작하기</a>
```

**실제 전송 시 변환:**
```html
<p>안녕하세요, 홍길동님!</p>
<p>안전보건교육 기초 교육을 2025-12-31까지 완료해주세요.</p>
<a href="http://safety.company.com/courses">교육 시작하기</a>
```

### 1.4 템플릿 수정

1. 템플릿 목록에서 수정할 템플릿 클릭
2. 내용 수정
3. **"저장"** 버튼 클릭

### 1.5 템플릿 삭제

⚠️ **주의:** 삭제된 템플릿은 복구할 수 없습니다.

1. 삭제할 템플릿 선택
2. **"삭제"** 버튼 클릭
3. 확인 메시지에서 **"확인"** 클릭

### 1.6 템플릿 미리보기

실제 발송 전 이메일이 어떻게 보이는지 확인:

1. 템플릿 선택
2. **"미리보기"** 버튼 클릭
3. 샘플 데이터로 렌더링된 이메일 확인

---

## 2. 스케줄 관리

정기적으로 자동 발송되는 이메일을 설정합니다.

### 2.1 스케줄이란?

특정 시간에 자동으로 이메일을 발송하는 기능입니다.

**예시:**
- 매일 오전 7시에 교육 미이수자에게 알림
- 평일 오전 6시에 TBM 작성 독려
- 매월 4일 오전 9시에 안전점검 알림

### 2.2 새 스케줄 만들기

**단계:**
1. **"새 스케줄 생성"** 버튼 클릭
2. 스케줄 정보 입력:

| 필드 | 설명 | 예시 |
|------|------|------|
| **스케줄 이름** | 스케줄을 구분하는 이름 | `교육 미이수자 일일 알림` |
| **템플릿** | 사용할 이메일 템플릿 선택 | `교육 미이수자 알림` |
| **Cron 표현식** | 발송 시간 설정 | `0 7 * * *` (매일 오전 7시) |
| **설명** | 스케줄 설명 (선택사항) | `매일 오전 7시에 발송` |
| **활성화** | 사용 여부 | 체크 ✓ |

3. **"저장"** 버튼 클릭

### 2.3 Cron 표현식 가이드

Cron 표현식은 스케줄 시간을 설정하는 형식입니다.

**형식:** `분 시 일 월 요일`

| 필드 | 값 범위 | 설명 |
|------|--------|------|
| 분 | 0-59 | 분 |
| 시 | 0-23 | 시 (24시간 형식) |
| 일 | 1-31 | 일 |
| 월 | 1-12 | 월 |
| 요일 | 0-7 | 요일 (0과 7은 일요일, 1은 월요일) |

**특수 문자:**
- `*` - 모든 값
- `,` - 여러 값 (예: `1,3,5` - 1일, 3일, 5일)
- `-` - 범위 (예: `1-5` - 월~금)
- `/` - 간격 (예: `*/10` - 10분마다)

**자주 사용하는 예시:**

| Cron 표현식 | 설명 |
|------------|------|
| `0 7 * * *` | 매일 오전 7시 |
| `0 6 * * 1-5` | 평일(월~금) 오전 6시 |
| `0 9 4 * *` | 매월 4일 오전 9시 |
| `0 0 1 * *` | 매월 1일 자정 |
| `*/30 * * * *` | 30분마다 |
| `0 */2 * * *` | 2시간마다 |
| `0 8-18 * * 1-5` | 평일 오전 8시~오후 6시(매시 정각) |

**Cron 표현식 생성 도구:**
- https://crontab.guru (온라인 도구, 영문)
- https://crontab.cronhub.io (시각적 도구)

### 2.4 스케줄 수정/삭제

**수정:**
1. 스케줄 목록에서 수정할 스케줄 클릭
2. 내용 수정 (Cron 표현식, 템플릿 등)
3. **"저장"** 버튼 클릭

**삭제:**
1. 삭제할 스케줄 선택
2. **"삭제"** 버튼 클릭

### 2.5 스케줄 활성화/비활성화

**방법 1: 토글 버튼**
- 스케줄 목록에서 활성화 토글을 클릭

**방법 2: 수정 화면**
- 스케줄 수정 시 "활성화" 체크박스 선택/해제

**비활성화된 스케줄:**
- 이메일이 발송되지 않음
- 목록에 "비활성" 상태로 표시
- 언제든 다시 활성화 가능

### 2.6 마지막 실행 및 다음 실행 확인

스케줄 목록에서 확인할 수 있습니다:
- **마지막 실행**: 가장 최근 발송 시간
- **다음 실행**: 다음 발송 예정 시간

---

## 3. 조건부 발송

특정 조건이 충족되면 자동으로 이메일을 발송하는 기능입니다.

### 3.1 조건부 발송이란?

스케줄과 달리, 시스템이 조건을 확인하여 자동으로 발송합니다.

**예시:**
- TBM을 3일 동안 작성하지 않으면 → 팀장에게 알림
- 교육 마감일을 3일 지나면 → 미이수자에게 알림
- 승인 대기가 3일 이상이면 → 임원에게 알림

### 3.2 새 조건 만들기

**단계:**
1. **"새 조건 생성"** 버튼 클릭
2. 조건 정보 입력:

| 필드 | 설명 | 예시 |
|------|------|------|
| **조건 이름** | 조건을 구분하는 이름 | `TBM 3일 미작성 알림` |
| **조건 타입** | 조건 종류 선택 | `TBM_NOT_SUBMITTED_DAYS` |
| **이메일 템플릿** | 발송할 템플릿 선택 | `TBM 작성 독려` |
| **수신자** | 누구에게 발송할지 선택 | `팀장` |
| **설명** | 조건 설명 (선택사항) | `TBM을 3일 동안 작성하지 않은 팀에게 발송` |
| **활성화** | 사용 여부 | 체크 ✓ |

3. **"저장"** 버튼 클릭

### 3.3 조건 타입 설명

시스템에서 제공하는 조건 타입:

#### 1. TBM_NOT_SUBMITTED_DAYS
**설명:** TBM을 N일 동안 작성하지 않은 팀

**파라미터:**
```json
{
  "days": 3
}
```

**수신자:** 팀장

**발송 조건:** 팀의 마지막 TBM 작성일이 3일 이전

---

#### 2. TBM_NOT_SUBMITTED_TODAY
**설명:** 오늘 TBM을 작성하지 않은 팀

**파라미터:** 없음

**수신자:** 팀장

**발송 조건:** 오늘 날짜에 TBM 미작성

---

#### 3. MONTHLY_REPORT_COMPLETED
**설명:** 월별 보고서가 제출됨

**파라미터:**
```json
{
  "month": "2025-11"
}
```

**수신자:** 임원, 관리자

**발송 조건:** 해당 월의 보고서 제출 시

---

#### 4. EDUCATION_OVERDUE
**설명:** 교육이 마감일을 N일 경과

**파라미터:**
```json
{
  "days": 3
}
```

**수신자:** 미이수자

**발송 조건:** 마지막 접속일이 N일 이전

---

#### 5. EDUCATION_COMPLETION_LOW
**설명:** 팀의 교육 이수율이 낮음

**파라미터:**
```json
{
  "threshold": 50
}
```

**수신자:** 팀장

**발송 조건:** 팀 이수율이 50% 미만

---

#### 6. SAFETY_INSPECTION_DUE
**설명:** 안전점검 기한이 임박

**파라미터:**
```json
{
  "daysBeforeDue": 3
}
```

**수신자:** 팀장, 관리자

**발송 조건:** 매월 10일 기준, 3일 전(7일)에 발송

---

#### 7. APPROVAL_PENDING_DAYS
**설명:** 승인이 N일 동안 대기 중

**파라미터:**
```json
{
  "days": 3
}
```

**수신자:** 임원

**발송 조건:** 승인 대기가 3일 이상인 항목

---

### 3.4 조건 테스트 (중요!)

실제 발송 전에 조건을 테스트할 수 있습니다.

**단계:**
1. 조건 목록에서 테스트할 조건 선택
2. **"테스트"** 버튼 클릭
3. 테스트 결과 확인:
   - 발송 대상자 수
   - 발송 대상자 목록
   - 이메일 내용 미리보기
   - 중복 발송 여부

**중요:** 테스트는 실제로 이메일을 발송하지 않습니다.

### 3.5 조건 즉시 실행

조건을 수동으로 실행할 수 있습니다.

**단계:**
1. 조건 목록에서 실행할 조건 선택
2. **"실행"** 버튼 클릭
3. 확인 메시지에서 **"확인"** 클릭
4. 실행 결과 확인:
   - 발송 성공 수
   - 발송 실패 수
   - 중복 방지로 스킵된 수

### 3.6 중복 발송 방지

시스템은 24시간 이내에 같은 조건으로 같은 사용자에게 중복 발송하지 않습니다.

**예시:**
- 오전 10시에 "TBM 3일 미작성" 조건으로 홍길동 팀장에게 발송
- 오후 2시에 같은 조건 재실행 → 홍길동 팀장에게는 발송 안 함 (24시간 이내)
- 다음날 오전 10시 이후 → 조건 충족 시 다시 발송 가능

### 3.7 조건 확인 주기

조건은 **1시간마다** 자동으로 확인됩니다.

- 스케줄: 정확한 시간에 실행 (예: 매일 오전 7시)
- 조건: 매 시간 정각에 확인 (00:00, 01:00, 02:00, ...)

**예시:**
```
09:00 - 조건 확인 → TBM 3일 미작성 팀 발견 → 이메일 발송
10:00 - 조건 확인 → 같은 팀은 24시간 이내라 스킵
11:00 - 조건 확인 → 새로운 팀 발견 시 발송
```

---

## 4. 발송 이력

전송된 이메일의 기록을 확인합니다.

### 4.1 발송 이력 보기

**표시 정보:**
- 발송 일시
- 템플릿 타입
- 수신자 이메일
- 발송 상태 (성공/실패)
- 오류 메시지 (실패 시)

### 4.2 발송 이력 필터링

**필터 옵션:**
- **날짜 범위**: 시작일 ~ 종료일
- **상태**: 전체 / 성공 / 실패
- **수신자**: 이메일 주소로 검색
- **템플릿 타입**: 특정 타입만 보기

**사용 예시:**
```
날짜: 2025-11-01 ~ 2025-11-14
상태: 실패
```
→ 2주간 실패한 이메일만 확인

### 4.3 발송 통계

화면 상단에 통계가 표시됩니다:

| 통계 항목 | 설명 |
|----------|------|
| **오늘 발송** | 오늘 발송된 이메일 수 |
| **이번 주 발송** | 이번 주 발송된 이메일 수 |
| **이번 달 발송** | 이번 달 발송된 이메일 수 |
| **총 실패** | 전체 기간 동안 실패한 이메일 수 |

### 4.4 페이지네이션

이력이 많을 경우 페이지로 나뉘어 표시됩니다.
- 페이지당 10개 항목
- 하단에 페이지 번호 표시
- 이전/다음 버튼으로 이동

---

## 5. 테스트 발송

실제 발송 전에 이메일을 테스트합니다.

### 5.1 SMTP 연결 확인

**목적:** 이메일 서버가 정상 작동하는지 확인

**단계:**
1. **"SMTP 연결 테스트"** 버튼 클릭
2. 결과 확인:
   - ✅ 성공: "SMTP 연결 성공!"
   - ❌ 실패: 오류 메시지 표시

**실패 시 확인사항:**
- SMTP 서버가 실행 중인가?
- `.env` 파일의 SMTP 설정이 올바른가?
- 방화벽에서 SMTP 포트가 열려 있는가?

### 5.2 테스트 이메일 발송

**목적:** 실제로 이메일이 발송되고 수신되는지 확인

**단계:**
1. **"테스트 이메일 발송"** 버튼 클릭
2. 테스트 이메일 주소 입력 (기본값: 본인 이메일)
3. **"발송"** 버튼 클릭
4. 메일함 확인

**테스트 이메일 내용:**
- 제목: `[테스트] 이메일 시스템 테스트`
- 본문: 시스템 정보, 발송 시간, 테스트 메시지

### 5.3 템플릿별 테스트 발송

특정 템플릿으로 테스트 이메일을 발송합니다.

**단계:**
1. 템플릿 선택
2. **"템플릿 테스트"** 버튼 클릭
3. 테스트 데이터 입력 (변수 값)
4. 테스트 이메일 주소 입력
5. **"발송"** 버튼 클릭
6. 메일함에서 확인

**예시:**
```
템플릿: 교육 미이수자 알림
변수:
  userName: 홍길동
  courseName: 안전보건교육 기초
  dueDate: 2025-12-31
수신자: test@company.com
```

### 5.4 템플릿 미리보기

실제 발송 없이 이메일이 어떻게 보이는지 확인합니다.

**단계:**
1. 템플릿 선택
2. **"미리보기"** 버튼 클릭
3. 샘플 데이터로 렌더링된 HTML 확인
4. 브라우저에서 직접 확인

**확인사항:**
- 제목이 올바른가?
- 변수가 잘 치환되었는가?
- 버튼과 링크가 작동하는가?
- 한글이 깨지지 않는가?
- 디자인이 의도대로 표시되는가?

---

## FAQ

### Q1. 이메일이 발송되지 않아요

**확인사항:**
1. SMTP 연결 테스트 성공했나요?
   - 테스트 발송 탭에서 "SMTP 연결 테스트" 클릭
2. 템플릿/스케줄/조건이 활성화되어 있나요?
   - 비활성 상태면 발송되지 않습니다
3. 수신자 이메일 주소가 올바른가요?
   - 사용자 프로필에서 이메일 주소 확인
4. 스팸함을 확인했나요?
   - 스팸 폴더에 도착했을 수 있습니다

### Q2. 이메일이 중복으로 발송돼요

**원인:**
- 여러 조건이 같은 템플릿을 사용할 때
- 스케줄과 조건이 동시에 실행될 때

**해결:**
- 시스템은 24시간 이내 중복 발송을 자동으로 방지합니다
- 조건 설정을 검토하여 중복을 제거하세요

### Q3. Cron 표현식을 어떻게 작성하나요?

**도구 사용:**
- https://crontab.guru 방문
- 원하는 시간을 선택하면 자동으로 표현식 생성
- 표현식을 복사하여 붙여넣기

**예시:**
```
매일 오전 7시 → 0 7 * * *
평일 오전 6시 → 0 6 * * 1-5
매월 1일 오전 9시 → 0 9 1 * *
```

### Q4. 템플릿에서 변수가 치환되지 않아요

**확인사항:**
1. 변수 형식이 올바른가요?
   - 올바른 형식: `{{userName}}`
   - 잘못된 형식: `{userName}`, `{{{userName}}}`, `$userName`
2. 변수 이름이 정확한가요?
   - 대소문자 구분: `{{userName}}` ≠ `{{username}}`
3. 변수가 "사용 가능한 변수" 목록에 포함되어 있나요?
   - 템플릿 수정 화면에서 확인

### Q5. 발송 이력에서 "실패" 상태가 많아요

**확인:**
1. 발송 이력 탭에서 실패한 이메일 클릭
2. 오류 메시지 확인
3. 일반적인 오류:
   - `Invalid email address` → 수신자 이메일 주소 오류
   - `Connection timeout` → SMTP 서버 연결 문제
   - `Authentication failed` → SMTP 인증 실패

### Q6. 스케줄이 예정 시간에 실행되지 않아요

**확인사항:**
1. 스케줄이 활성화되어 있나요?
   - 스케줄 목록에서 "활성" 상태 확인
2. 서버가 실행 중인가요?
   - 서버가 중지되면 스케줄도 실행 안 됨
3. Cron 표현식이 올바른가요?
   - https://crontab.guru에서 검증
4. 서버 시간이 정확한가요?
   - 서버 시간대(timezone) 확인

### Q7. 조건 테스트 결과 "발송 대상자 0명"이 나와요

**원인:**
- 조건에 맞는 사용자가 실제로 없음
- 조건 파라미터가 너무 엄격함

**확인:**
1. 조건 타입과 파라미터를 확인하세요
   - 예: TBM 3일 미작성 → 실제로 3일 동안 작성 안 한 팀이 있나요?
2. 데이터베이스에 데이터가 있나요?
   - 사용자, 교육 과정, TBM 등
3. 조건을 완화해보세요
   - 예: 3일 → 1일로 변경하여 테스트

### Q8. 이메일 디자인을 변경하고 싶어요

**방법:**
1. 템플릿 관리 탭으로 이동
2. 수정할 템플릿 선택
3. "HTML 내용" 필드에서 HTML 코드 수정
4. **"미리보기"** 버튼으로 확인
5. **"저장"** 버튼 클릭

**주의:**
- HTML과 CSS 기본 지식이 필요합니다
- 인라인 CSS 사용을 권장합니다 (이메일 클라이언트 호환성)
- 테스트 발송으로 실제 렌더링을 확인하세요

### Q9. 특정 사용자에게만 이메일을 보내고 싶어요

**방법 1: 조건부 발송 사용**
- 특정 조건에 맞는 사용자만 자동 발송

**방법 2: 수동 발송 (개발 필요)**
- 현재는 자동화된 발송만 지원
- 수동 발송 기능은 향후 추가 예정

**방법 3: 테스트 발송 활용**
- 템플릿 테스트 기능으로 특정 이메일 주소로 발송 가능

### Q10. 이메일에 첨부파일을 추가할 수 있나요?

**현재 상태:** 첨부파일 기능은 지원되지 않습니다.

**대안:**
- 이메일 본문에 다운로드 링크 추가
- 파일을 서버에 업로드하고 URL을 변수로 사용
- 예: `{{certificateUrl}}` - 이수증 다운로드 링크

---

## 문제 해결

### 문제 1: SMTP 연결 실패

**증상:**
```
❌ SMTP 연결 실패: connect ECONNREFUSED
```

**해결 방법:**

1. **SMTP 서버 확인**
   ```bash
   # Windows PowerShell
   Test-NetConnection -ComputerName 192.168.1.100 -Port 25
   ```

2. **.env 파일 확인**
   ```bash
   SMTP_HOST=192.168.1.100
   SMTP_PORT=25
   SMTP_FROM=safety@company.com
   ```

3. **방화벽 확인**
   - Windows 방화벽에서 포트 25 허용
   - 보안 프로그램에서 차단 여부 확인

4. **SMTP 서버 재시작**
   - SMTP 서버 관리자에게 문의

---

### 문제 2: 인증 오류

**증상:**
```
❌ Authentication failed
```

**해결 방법:**

1. **인증이 필요한 경우**
   `.env` 파일에 추가:
   ```bash
   SMTP_USER=your-email@company.com
   SMTP_PASSWORD=your-password
   ```

2. **인증이 필요 없는 경우 (내부 SMTP)**
   `.env` 파일에서 제거:
   ```bash
   # SMTP_USER 삭제
   # SMTP_PASSWORD 삭제
   ```

3. **서버 재시작**
   ```bash
   # 서버 중지 후 재시작
   npm run dev
   ```

---

### 문제 3: 한글 깨짐

**증상:**
- 이메일 제목이나 본문에서 한글이 깨져 보임

**해결 방법:**

1. **템플릿 인코딩 확인**
   - 템플릿 파일이 UTF-8로 저장되어 있는지 확인

2. **이메일 클라이언트 확인**
   - 다른 이메일 클라이언트(Gmail, Outlook 등)에서 테스트

3. **HTML 헤더 추가**
   템플릿 HTML 상단에 추가:
   ```html
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   ```

---

### 문제 4: 이메일이 스팸으로 분류됨

**원인:**
- 발신자 주소가 신뢰되지 않음
- 이메일 내용에 스팸 키워드 포함
- SPF, DKIM 설정 누락

**해결 방법:**

1. **발신자 주소 변경**
   - 신뢰할 수 있는 도메인 사용
   - 예: `noreply@company.com`

2. **SPF 레코드 설정 (IT 담당자에게 요청)**
   ```
   v=spf1 ip4:192.168.1.100 ~all
   ```

3. **이메일 내용 검토**
   - 과도한 대문자 사용 지양
   - 스팸 키워드 제거
   - 명확한 발신자 정보 포함

4. **수신자에게 안내**
   - 첫 이메일은 스팸함 확인 요청
   - "스팸 아님" 처리 요청

---

### 문제 5: 변수가 빈 값으로 표시됨

**증상:**
```
안녕하세요, 님!  ← userName이 빈 값
```

**해결 방법:**

1. **사용자 데이터 확인**
   - 데이터베이스에서 사용자 이름이 입력되어 있는지 확인
   - 예: `users` 테이블의 `name` 필드

2. **변수 매핑 확인**
   - `emailService.ts` 파일에서 변수 매핑 확인
   - 올바른 데이터베이스 필드와 연결되어 있는지 확인

3. **템플릿 변수 목록 확인**
   - 템플릿의 "사용 가능한 변수" 목록에 변수가 포함되어 있는지 확인

---

### 문제 6: 대량 발송 시 서버 지연

**증상:**
- 수백 명에게 동시 발송 시 서버가 느려짐

**해결 방법:**

1. **발송 제한 설정**
   - 조건별로 최대 발송 수 제한
   - 예: 한 번에 최대 100명

2. **발송 간격 설정**
   - 이메일 사이에 지연 추가
   - 예: 100ms 간격

3. **스케줄 분산**
   - 여러 스케줄로 분산 발송
   - 예: 오전 7시, 오전 9시, 오전 11시

4. **서버 리소스 확인**
   - CPU, 메모리 사용량 확인
   - 필요 시 서버 성능 업그레이드

---

## 추가 도움말

### 관련 문서
- [이메일 기능 테스트 가이드](./EMAIL_TEST_GUIDE.md) - 개발자용 테스트 가이드
- [이메일 기능 README](./EMAIL_기능_README.md) - 기술 문서

### 지원 요청
문제가 해결되지 않으면 시스템 관리자에게 문의하세요:
- 발송 이력에서 오류 메시지 캡처
- 스크린샷 첨부
- 재현 가능한 단계 설명

### 업데이트 로그
- 2025-11-14: 초기 버전 작성
- 조건부 발송 기능 추가
- 중복 발송 방지 기능 추가
- 7가지 이메일 템플릿 지원

---

**문서 버전:** 1.0
**최종 수정일:** 2025-11-14
**작성자:** 시스템 관리자
