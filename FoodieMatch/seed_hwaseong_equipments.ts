import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// 화성공장 팀별 장비 데이터 (첫번째 표)
const equipmentData1: Record<string, Record<string, number>> = {
  '선삭': { '지게차': 2, '크레인': 14, '컨베이어': 0, 'CNC선반': 6, 'MCT': 9, 'Deep Hole': 1, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 1, '시편절단기': 0, '탁상용연삭기': 1, '밴드쏘우': 1, '칩이송장치': 1, '굴착기': 0, '테스트크레인': 0 },
  '연삭': { '지게차': 0, '크레인': 7, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 1, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 12, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  'M/B': { '지게차': 2, '크레인': 9, '컨베이어': 1, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 1, '세척기': 0, '연삭기': 1, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  'BKT': { '지게차': 1, '크레인': 7, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  'CR조립': { '지게차': 3, '크레인': 13, '컨베이어': 1, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 1, '반전기': 1, '세척기': 0, '연삭기': 0, '도장장/건조로': 1, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 1, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  '열처리': { '지게차': 1, '크레인': 4, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 8, '세척조/피트로/유조로': 9, '열처리/올케이스로': 3, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  'CR자재': { '지게차': 2, '크레인': 0, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 1, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  '품질서비스': { '지게차': 1, '크레인': 8, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 1, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  'CR출하': { '지게차': 1, '크레인': 4, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  'BR출하': { '지게차': 2, '크레인': 2, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  '자재부품': { '지게차': 3, '크레인': 4, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  '2공장': { '지게차': 3, '크레인': 7, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 1, '연삭기': 0, '도장장/건조로': 3, '밧데리충전기': 0, '템퍼링로': 2, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 0, '시편절단기': 0, '탁상용연삭기': 7, '밴드쏘우': 0, '칩이송장치': 0, '굴착기': 0, '테스트크레인': 0 },
  '연구소': { '지게차': 0, '크레인': 0, '컨베이어': 0, 'CNC선반': 0, 'MCT': 0, 'Deep Hole': 0, '용접기': 0, '반전기': 0, '세척기': 0, '연삭기': 0, '도장장/건조로': 0, '밧데리충전기': 0, '템퍼링로': 0, '세척조/피트로/유조로': 0, '열처리/올케이스로': 0, '드릴(레디알)': 1, '시편절단기': 0, '탁상용연삭기': 0, '밴드쏘우': 0, '칩이송장치': 4, '굴착기': 1, '테스트크레인': 0 },
};

// 화성공장 팀별 장비 데이터 (두번째 표)
const equipmentData2: Record<string, Record<string, number>> = {
  '선삭': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 1, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 1, '걸이구': 1, '압력용기': 1, '공기압축기': 0, '가스분배기/쇼트기': 0 },
  '연삭': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 1, '걸이구': 0, '압력용기': 0, '공기압축기': 1, '가스분배기/쇼트기': 0 },
  'M/B': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 1, '산소절단기': 1, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 1, '걸이구': 0, '압력용기': 1, '공기압축기': 0, '가스분배기/쇼트기': 0 },
  'BKT': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 1, '걸이구': 1, '압력용기': 0, '공기압축기': 1, '가스분배기/쇼트기': 0 },
  'CR조립': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 1, '작업대/발판': 0, '둥근톱': 1, '산소절단기': 1, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 1, '걸이구': 1, '압력용기': 1, '공기압축기': 2, '가스분배기/쇼트기': 0 },
  '열처리': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 0, '걸이구': 1, '압력용기': 0, '공기압축기': 2, '가스분배기/쇼트기': 0 },
  'CR자재': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 0, '걸이구': 0, '압력용기': 0, '공기압축기': 1, '가스분배기/쇼트기': 0 },
  '품질서비스': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 1, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 1, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 1, '걸이구': 0, '압력용기': 0, '공기압축기': 1, '가스분배기/쇼트기': 0 },
  'CR출하': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 0, '걸이구': 0, '압력용기': 0, '공기압축기': 1, '가스분배기/쇼트기': 0 },
  'BR출하': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 1, '작업대/발판': 0, '둥근톱': 1, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 0, '걸이구': 0, '압력용기': 0, '공기압축기': 1, '가스분배기/쇼트기': 0 },
  '자재부품': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 1, '걸이구': 1, '압력용기': 0, '공기압축기': 1, '가스분배기/쇼트기': 0 },
  '2공장': { '고속절단기': 1, '핸드그라인더': 1, '전동드릴/타카': 0, '작업대/발판': 0, '둥근톱': 1, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 1, '걸이구': 1, '압력용기': 2, '공기압축기': 0, '가스분배기/쇼트기': 2 },
  '연구소': { '고속절단기': 0, '핸드그라인더': 0, '전동드릴/타카': 1, '작업대/발판': 0, '둥근톱': 0, '산소절단기': 0, '위험물/가스저장소': 1, '소화전/소화기': 1, '분배전반': 0, '걸이구': 0, '압력용기': 0, '공기압축기': 0, '가스분배기/쇼트기': 0 },
};

// 팀 이름 매핑 (데이터의 이름 -> DB의 팀 이름)
const teamNameMapping: Record<string, string[]> = {
  '선삭': ['선삭'],
  '연삭': ['연삭'],
  'M/B': ['M/B'],
  'BKT': ['BKT'],
  'CR조립': ['CR조립'],
  '열처리': ['열처리'],
  'CR자재': ['CR자재'],
  '품질서비스': ['품질서비스'],
  'CR출하': ['CR출하'],
  'BR출하': ['BR출하'],
  '자재부품': ['자재부품'],
  '2공장': ['2공장'],
  '연구소': ['연구소'],
};

async function seedHwaseongEquipments() {
  console.log('🔄 화성공장 팀별 장비 데이터 입력 시작...\n');

  // 화성공장 팀 조회
  const hwaseongTeams = await prisma.team.findMany({
    where: { site: '화성' },
    orderBy: { name: 'asc' }
  });

  console.log(`📋 화성공장 팀 수: ${hwaseongTeams.length}개\n`);

  // 팀 이름으로 ID 찾기
  const teamIdMap = new Map<string, number>();
  for (const team of hwaseongTeams) {
    teamIdMap.set(team.name, team.id);
    console.log(`  - ${team.name} (ID: ${team.id})`);
  }

  console.log('\n');

  let totalInserted = 0;
  let totalSkipped = 0;
  let totalUpdated = 0;

  // 두 데이터를 합쳐서 처리
  for (const [teamKey, equipments1] of Object.entries(equipmentData1)) {
    const possibleNames = teamNameMapping[teamKey] || [teamKey];

    let teamId: number | undefined;
    for (const name of possibleNames) {
      if (teamIdMap.has(name)) {
        teamId = teamIdMap.get(name);
        break;
      }
    }

    if (!teamId) {
      console.log(`⚠️ 팀을 찾을 수 없음: ${teamKey}`);
      continue;
    }

    console.log(`\n📦 ${teamKey} (ID: ${teamId}) 장비 처리 중...`);

    // 첫번째 표 장비
    for (const [equipName, quantity] of Object.entries(equipments1)) {
      if (quantity > 0) {
        try {
          await prisma.teamEquipment.upsert({
            where: {
              teamId_equipmentName: { teamId, equipmentName: equipName }
            },
            update: { quantity },
            create: { teamId, equipmentName: equipName, quantity }
          });
          console.log(`  ✅ ${equipName}: ${quantity}개`);
          totalInserted++;
        } catch (error) {
          console.log(`  ❌ ${equipName} 실패:`, error);
        }
      }
    }

    // 두번째 표 장비
    const equipments2 = equipmentData2[teamKey];
    if (equipments2) {
      for (const [equipName, quantity] of Object.entries(equipments2)) {
        if (quantity > 0) {
          try {
            await prisma.teamEquipment.upsert({
              where: {
                teamId_equipmentName: { teamId, equipmentName: equipName }
              },
              update: { quantity },
              create: { teamId, equipmentName: equipName, quantity }
            });
            console.log(`  ✅ ${equipName}: ${quantity}개`);
            totalInserted++;
          } catch (error) {
            console.log(`  ❌ ${equipName} 실패:`, error);
          }
        }
      }
    }
  }

  console.log(`\n✅ 장비 데이터 입력 완료!`);
  console.log(`   - 입력/업데이트: ${totalInserted}건`);

  // 결과 확인
  const totalEquipments = await prisma.teamEquipment.count({
    where: {
      team: { site: '화성' }
    }
  });
  console.log(`   - 화성공장 총 장비 레코드: ${totalEquipments}개`);

  await prisma.$disconnect();
}

seedHwaseongEquipments().catch(console.error);
